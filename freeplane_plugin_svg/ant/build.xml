<project name="freeplane_svg" default="dist" basedir="..">
	<property name="ver" value="1.0.1" />
	<property name="src" value="src" />
	<property name = "root" value = "."/>
	<property name="osgimanifest" value="${root}/META-INF/MANIFEST.MF" />	
	<property name="external.lib" value="${root}/lib" />
	<property name="framework.jar" value="${root}/../freeplane_framework/lib/knopflerfish/framework.jar" />
	<property name="freeplane.dist.lib" value="${root}/../freeplane/bin/dist/lib" />
	<property name="freeplane.jars" value="${freeplane.dist.lib}/freeplaneviewer.jar:${freeplane.dist.lib}/freeplaneeditor.jar:${freeplane.dist.lib}/freeplaneosgi.jar" />
	<property name="external.dist.lib" value="${root}/../freeplane/bin/dist/lib" />
	<property name="external.jars" value="${external.dist.lib}/commons-lang-2.0.jar:${external.dist.lib}/forms-1.0.5.jar:${external.dist.lib}/SimplyHTML/SimplyHTML.jar" />
	<property name="build" value="${root}/build" />
	<property name="bin" value="${root}/bin" />
	<property name="dist" value="${bin}/dist" />
	<property name="dist.lib" value="${dist}/lib" />
	<property name="dist.osgi.dir" value="${dist}/osgi/dir" />
	<property name="dist.osgi.jar" value="${dist}/osgi/jar" />
	<property name="freeplaneplugin.jar" value="${dist.osgi.jar}/org.freeplane.plugin.svg.jar"/>
	<property name="debug" value="on" />
	<property name="java_source_version" value="1.5" />
	<property name="java_target_version" value="1.5" />
	<property name="build.compiler" value="modern" />
	<property name="batik.jars" value="${external.lib}/batik-awt-util.jar:${external.lib}/batik-bridge.jar:${external.lib}/batik-css.jar:${external.lib}/batik-dom.jar:${external.lib}/batik-extension.jar:${external.lib}/batik-ext.jar:${external.lib}/batik-codec.jar:${external.lib}/batik-anim.jar:${external.lib}/batik-gui-util.jar:${external.lib}/batik-gvt.jar:${external.lib}/batik-parser.jar:${external.lib}/batik-script.jar:${external.lib}/batik-svg-dom.jar:${external.lib}/batik-svggen.jar:${external.lib}/batik-swing.jar:${external.lib}/batik-transcoder.jar:${external.lib}/batik-util.jar:${external.lib}/batik-xml.jar"/>
	<property name="classpath" value="${framework.jar}:${freeplane.jars}:${external.jars}:${batik.jars}:${external.lib}/js.jar:${external.lib}/pdf-transcoder.jar:${external.lib}/xerces_2_5_0.jar:${external.lib}/xml-apis.jar:${external.lib}/xml-apis-ext.jar"/>

	<target name="build">
		<echo>Freeplane Version = ${ver}.</echo>
		<delete dir="${build}"  quiet="true"/>
		<mkdir dir="${build}" />
		<javac srcdir="${src}" destdir="${build}" classpath="${classpath}" debug="${debug}" 
			source="${java_source_version}" target="${java_target_version}">
		</javac>
	</target>


	<target name="dist" depends="build">
		<jar jarfile="lib/plugin.jar">
			<fileset dir="${build}"/>
		</jar>
		<delete dir="${dist.osgi.dir}" quiet="true"/>
		<mkdir dir="${dist.osgi.dir}" />
		<copy todir="${dist.osgi.dir}">
			<fileset dir="${root}">
				<include name="lib/**"/>
			</fileset>
		</copy>
		<mkdir dir="${dist.osgi.dir}/META-INF" />
		<copyfile dest="${dist.osgi.dir}/META-INF/MANIFEST.MF" src="${osgimanifest}"/>
		<delete dir="${build}"  quiet="true"/>
		<delete file="lib/plugin.jar" quiet="true"/>
	</target>

	<target name="osgi_dist_as_jar" depends="dist">
		<mkdir dir="${dist.osgi.jar}" />
		<jar jarfile="${freeplaneplugin.jar}">
			<fileset dir="${dist.osgi.dir}">
				<include name="**" />
			</fileset>
		</jar>
	</target>
	
	<target name="clean">
		<delete dir="${build}"  quiet="true"/>
		<delete dir="${bin}"  quiet="true"/>
		<delete>
			<fileset defaultexcludes="no" dir="${src}" includes="**/*~"/>
		</delete>
	</target>
	
</project>

