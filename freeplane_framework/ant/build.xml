<project name="freeplane" default="dist" basedir="..">
	<property name = "workspace" value = ".."/>
	<property file="${workspace}/freeplane/viewer-resources/version.properties"/>
	<property name="ver" value="${freeplane_version}" />
	<property name = "root" value = "."/>
	<property name="bin" value="${root}/bin" />
	<property name="dist" value="${root}/dist" />
	
	<target name="dist" depends="clean">
		<property name = "root" value = "."/>
		<property name="framework.jar" value="lib/knopflerfish/framework.jar" />
		<property name="freeplane.exe" value="windows-launcher/freeplane.exe" />
		<property name="license" value="license.txt" />
		<property name="readme_src" value="readme.txt" />
		<property name="bin.jars" value="${bin}/jars" />
		<property name="bin.resources" value="${bin}/resources" />
		<property name="bin.ortho" value="${bin}/resources/ortho" />
		<property name="script" value="${root}/script" />

		<ant antfile="ant/build.xml" target="osgi_dist" dir="${workspace}/freeplane" inheritall="false"/>
		<ant antfile="ant/build.xml" dir="${workspace}/freeplane_plugin_help" inheritall="false"/>
		<ant antfile="ant/build.xml" dir="${workspace}/freeplane_plugin_svg" inheritall="false"/>
		<ant antfile="ant/build.xml" dir="${workspace}/freeplane_plugin_latex" inheritall="false"/>
		<ant antfile="ant/build.xml" dir="${workspace}/freeplane_plugin_script" inheritall="false"/>
		<mkdir dir="${bin}" />
		<copy todir="${bin}">
			<fileset dir="${script}"/>
			<fileset file="${framework.jar}"/>
			<fileset file="${freeplane.exe}"/>
		</copy>
		<chmod file="${bin}/freeplane.sh" perm="ugo+rx"/>
		<mkdir dir="${bin.jars}" />
		<copy todir="${bin.jars}">
			<fileset dir="${workspace}/freeplane/bin/dist/osgi"/>
			<fileset dir="${workspace}/freeplane_plugin_help/bin/dist/osgi"/>
			<fileset dir="${workspace}/freeplane_plugin_latex/bin/dist/osgi"/>
			<fileset dir="${workspace}/freeplane_plugin_script/bin/dist/osgi"/>
			<fileset dir="${workspace}/freeplane_plugin_svg/bin/dist/osgi"/>
		</copy>
		<mkdir dir="${bin.resources}" />		
		<mkdir dir="${bin.ortho}" />		
		<copy todir="${bin.ortho}">
			<fileset dir="${workspace}/freeplane/ortho"/>
		</copy>
		
		<mkdir dir="${dist}" />	
		
		<zip destfile="${dist}/freeplane_bin-${ver}.zip" compress="false">
			<fileset dir="${bin}"/>
			<fileset dir="${root}">
				<include name="${license}"/>
			</fileset>
		</zip>
		
		<tar destfile="${dist}/freeplane_src-${ver}.tar.gz" compression="gzip">
			<tarfileset dir="${workspace}" mode="777" username="ant" group="ant">
				<include name="*freeplane*/**"/>
				<exclude name=".*/**"/>
				<exclude name="bin/**"/>
				<exclude name="dist/**"/>
				<exclude name="*/bin/**"/>
				<exclude name="*/build/**"/>
				<exclude name="*/dist/**"/>
			</tarfileset>
			<tarfileset dir="${root}" mode="777" username="ant" group="ant">
				<include name="${license}"/>
				<include name="${readme_src}"/>
			</tarfileset>
		</tar>
		
		<copy file="${workspace}/freeplane/resources/history_en.txt" todir="${dist}"/>
	</target>

	<target name="clean">
		 <delete quiet="true" includeemptydirs="true">
		    <fileset dir="${bin}"/>
		    <fileset dir="${dist}"/>
		  </delete>
	</target>
	
</project>

